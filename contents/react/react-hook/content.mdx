---
slug: react-hook
title: ë¦¬ì•¡íŠ¸ í›… ì‚¬ìš©í•˜ê¸°
description: í›…ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ ì‚¬ìš© ì˜ˆì‹œ
date: 2024-04-06
tags: ['react']
thumbnail: /assets/contents/react/react-hook/react1.png
published: true
---

<Callout type="info">
**ì´ ì‹œë¦¬ì¦ˆëŠ” ì´ 4ê°œì˜ ì»¨í…ì¸ ë¡œ ê¸°íšë˜ì–´ ìˆìŠµë‹ˆë‹¤.**

1. [ì—ì…‹ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ì (ì—ì…‹íƒ€ìš´ 1í¸ - ê°œìš”)](https://junghyeonsu.com/posts/asset-town-introduction/)
2. [ì—ì…‹ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ì (ì—ì…‹íƒ€ìš´ 2í¸ - Sanityë¥¼ ì´ìš©í•œ ì–´ë“œë¯¼)](https://junghyeonsu.com/posts/asset-town-admin-with-sanity/)
3. **ì—ì…‹ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ì (ì—ì…‹íƒ€ìš´ 3í¸ - Cloudflare Workers, R2ë¥¼ ì´ìš©í•œ ì›¹í›… ì²˜ë¦¬ì™€ CDN ìºì‹±) [í˜„ì¬ ê¸€]**
4. [ì—ì…‹ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ì (ì—ì…‹íƒ€ìš´ 4í¸ - Figma Pluginì„ ì´ìš©í•œ ì—ì…‹ ì „ì‹œ)](https://junghyeonsu.com/posts/asset-town-figma-plugin/)
</Callout>

<Callout type="danger">
í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” ì¼ì£¼ì¼ ë§Œì— ë§Œë“¤ì–´ì§„ í”„ë¡œì íŠ¸ë¡œ ì¶”í›„ì—ëŠ” ë§ì€ ë³€ê²½ì´ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
</Callout>

## Sanityì˜ CDNì„ ì´ìš©í•˜ì§€ ì•ŠëŠ” ì´ìœ 

Sanityì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì—ì…‹ë“¤ì„ ì˜¬ë¦¬ë©´ ê¸°ë³¸ì ìœ¼ë¡œ CDN URLì´ ì œê³µë©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ì „ì— 1í¸ì—ì„œ ì–¸ê¸‰í–ˆë“¯, CDN í•œ ë‹¬ ë¬´ë£Œ ë²”ìœ„ëŠ” 1,000,000 (ë°±ë§Œ) ìš”ì²­ê¹Œì§€ ë¬´ë£Œì…ë‹ˆë‹¤.

![ë°±ë§Œê¹Œì§€ ë¬´ë£Œ](./1.png)
[![HEROPY.DEV](./1.png)](https://heropy.dev/)

1,000,000 ì´ë¼ëŠ” ìˆ«ìê°€ í¬ê²Œ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ë‹¨ìˆœ ì¡°íšŒì— ëŒ€í•œ ìˆ«ìì´ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œëŠ” ì—„ì²­ ë¹ ë¥´ê²Œ ì˜¬ë¼ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ì œê°€ í˜„ì¬ ëª¸ ë‹´ê³  ìˆëŠ” ë‹¹ê·¼ê³¼ ê°™ì€ íŠ¸ë˜í”½ì´ ë§ì€ ê³³ë“¤ì—ì„œëŠ” ì´ëŸ° ë¹„ìš©ì´ í° ë¶€ë‹´ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ ì‹ ê²½ì¨ì£¼ì§€ ì•Šìœ¼ë©´ ê³¼ê¸ˆ í­íƒ„ì„ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” ì—ì…‹ì— ëŒ€í•œ ì›ë³¸ì€ Sanityì— ì €ì¥í•˜ê³ 
ì—ì…‹ì— ëŒ€í•œ ìˆ˜ì •ì´ë‚˜ ì‚­ì œë‚˜ ì¶”ê°€ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ì„œ Cloudflare Workersì— ì „ë‹¬ë˜ê³ 
Cloudflare Workersì—ì„œ R2ì— ìºì‹±ì„ í•˜ê³  CDN URLì„ ì œê³µí•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

## Sanity Webhook ë“±ë¡í•˜ê¸°

<Callout type="info">
[Webhook](https://docs.tosspayments.com/resources/glossary/webhook)ì€ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ, ì§€ì •ëœ URLë¡œ HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.
</Callout>

ìœ„ì—ì„œ ì„¤ëª…ë˜ì–´ìˆë“¯, Webhookì€ íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ, ì§€ì •ëœ URLë¡œ HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.

Sanityì—ì„œëŠ” `Create`, `Update`, `Delete`ì— ëŒ€í•œ ì´ë²¤íŠ¸ Webhookì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{/* ![Sanityì—ì„œ Webhook ë“±ë¡í•˜ëŠ” ê³³](./2.png) */}

Sanityì—ì„œëŠ” ì´ 2ê°œì˜ Webhookì„ ë¬´ë£Œë¡œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ Webhookì„ ì²˜ë¦¬í•´ì¤„ ì„œë²„ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ ì„œë²„ë¥¼ Cloudflare Workersë¥¼ ì´ìš©í•´ì„œ ë§Œë“¤ê±°êµ¬ìš”.

ê°„ë‹¨í•˜ê²Œ Webhook ë“±ë¡ í™”ë©´ì„ ì‚´í´ë³¼ê¹Œìš”?

{/* ![Webhook ë“±ë¡ í™”ë©´](./3.png) */}

ìœ„ì—ì„œë¶€í„° í•˜ë‚˜ì”© ì‚´í´ë³´ë©´

1. Name (Webhook ì´ë¦„)
2. Description (Webhook ì„¤ëª…)
3. **URL (Webhookì„ ì²˜ë¦¬í•´ì¤„ ì„œë²„ URL)**
4. **Dataset (ì–´ë–¤ ë°ì´í„°ì…‹ì— ëŒ€í•œ Webhookì¸ì§€)**
5. **Trigger On (ì–´ë–¤ ì´ë²¤íŠ¸ì— ëŒ€í•œ Webhookì¸ì§€)**
6. **Filter (ì–´ë–¤ í•„í„°ë¥¼ ê±¸ì–´ì„œ Webhookì„ ì²˜ë¦¬í• ì§€)**
7. **Projection (ì–´ë–¤ í•„ë“œì— ëŒ€í•œ Webhookì¸ì§€)**

ì´ë ‡ê²Œ 7ê°œ ì˜µì…˜ ì´ì™¸ì—ë„ `Status`, `HTTP Method`, `Headers` ë“±ì˜ ì˜µì…˜ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ìš”ê¸°ì„œ ì €í¬ëŠ” 3ë²ˆë¶€í„° 7ë²ˆê¹Œì§€ ì§‘ì¤‘í•˜ë©´ ì¢‹ì€ë°ìš”, ì–´ë–¤ì‹ìœ¼ë¡œ ì›¹í›… ì „ëµì„ ê°€ì ¸ê°ˆì§€ ìƒê°í•´ë³´ê² ìŠµë‹ˆë‹¤.

## Webhook ì „ëµ

<Callout type="info">
[Sanity Webhook ê³µì‹ ë¬¸ì„œ](https://www.sanity.io/docs/webhooks)
</Callout>

URLì€ Cloudflare Workersë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ ê¸°ë³¸ì ì¸ URLì„ ì œê³µë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•´ë‹¹ URLì„ Webhook URLë¡œ ë“±ë¡í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ ë‘ ê°œì˜ Webhookì„ ë¬´ë£Œë¡œ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `Create`, `Update`ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ”
Webhook í•˜ë‚˜ë‘ `Delete`ë¥¼ ì²˜ë¦¬í•˜ëŠ” Webhook í•˜ë‚˜ë¥¼ ë§Œë“¤ì–´ì„œ ì´ë ‡ê²Œ ë‘ ê°œë¡œ ìš´ì˜í• ê²ë‹ˆë‹¤.

- `Create`, `Update`ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•  Webhook: `https://<your-worker-url>/api/update`
- `Delete`ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•  Webhook: `https://<your-worker-url>/api/delete`

ê·¸ë¦¬ê³  Dataset ê°™ì€ ê²½ìš°ëŠ” Webhookì˜ Headersì— ë‹´ê²¨ì ¸ ì˜¤ëŠ” ë°ì´í„°ë¥¼ í†µí•´ì„œ
Develop í™˜ê²½ê³¼ Production í™˜ê²½ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ë”°ë¡œ í•´ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `all dataset`ìœ¼ë¡œ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.

Webhookì— Headersì— ë‹´ê²¨ì ¸ ì˜¤ëŠ” ë°ì´í„°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. (ì°¸ê³ )

```json showLineNumbers
{
  "conection": "close",
  "accept-encoding": "gzip",
  "idempotency-key": "<a unique key>",
  "content-type": "application/json",
  "content-length": "<the length of the payload in bytes>",
  "user-agent": "Sanity.io webhook delivery",
  "host": "<the endpoint URL host>",
  "sanity-transaction-id": "<ID of transaction>",
  "sanity-transaction-time": "<Timestamp of transaction>",
  "sanity-dataset": "<Name of dataset (also available in projection today as sanity::dataset())>",
  "sanity-document-id": "<Document ID being notified about>",
  "sanity-project-id": "<ID of project (also available in projection today as sanity::projectId())>",
  "sanity-webhook-id": "<ID of webhook>"
}
```

ê·¸ë¦¬ê³  Filterì™€ Projection ê°™ì€ ê²½ìš°ëŠ” Webhookì„ ì²˜ë¦¬í•  ë•Œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê±¸ëŸ¬ë‚´ê±°ë‚˜
í•„ìš”í•œ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤. GROQ ì¿¼ë¦¬ë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ìì‹ ì˜ í”„ë¡œì íŠ¸ì— ë§ê²Œ
ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤. ì € ê°™ì€ ê²½ìš°ì—ëŠ” Sanityì—ì„œ ì—ì…‹ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„° ëŒ€ë¶€ë¶„ì„ ë“¤ê³ ì˜µë‹ˆë‹¤.
Cloudflare R2ì— ì €ì¥í•  ë•Œ `Custom Metadata` í•„ë“œì— ì €ì¥í•´ì„œ ì¶”í›„ì— ì´ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

ì°¸ê³ ë¡œ ì €ëŠ” Webhookì˜ Filterì™€ Projectionì„ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

```groq showLineNumbers
// Filter
*[_type in ["lottie", "svg", "gif"]]

// Projection
{
  _id,
  _type,
  title,
  description,
  lottie -> {
    url,
    originalFilename,
    uploadId,
    assetId,
    extension,
    mimeType,
    path,
    _id,
    _type,
    _createdAt,
    _updatedAt
  },
  svg -> {
    ... ìœ„ì™€ ë™ì¼
  },
  gif -> {
    ... ìœ„ì™€ ë™ì¼
  }
}
```

[ ] : a link ë¡œ ë‚˜ì˜¤ëŠ”ë°.. ì´ ë¬¸ì œ í•´ê²°í•´ì•¼í•¨
## Cloudflare Workersë¥¼ ì´ìš©í•œ Webhook ì²˜ë¦¬

<Callout type="info">
[Cloudflare Workers](https://www.cloudflare.com/ko-kr/developer-platform/workers/)ëŠ” Cloudflareì—ì„œ ì œê³µí•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ì—¬ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¡œ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë²„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Callout>

ì´ì œëŠ” Cloudflare Workersë¥¼ ì´ìš©í•˜ì—¬ Webhookì„ ì²˜ë¦¬í•˜ëŠ” ì„œë²„ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

Cloudflare WorkersëŠ” ê¸°ë³¸ì ìœ¼ë¡œ JavaScript í˜¹ì€ TypeScriptë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  REST APIë¥¼ ì´ìš©í•˜ì—¬ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” [itty-router](https://github.com/kwhitley/itty-router)ë¥¼ ì´ìš©í•˜ì—¬ ë¼ìš°íŒ…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ„ì—ì„œ ì„¤ëª…í–ˆë“¯, ìš°ë¦¬ëŠ” ë‘ ê°œì˜ Webhookì„ ì²˜ë¦¬í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ë‘ ê°œì˜ Routeë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

```typescript showLineNumbers
// https://github.com/junghyeonsu/asset-town/blob/main/workers/src/index.ts
import { Router } from "itty-router";

import { handleOptions } from "./helper"; // CORS ì²˜ë¦¬ë¥¼ ìœ„í•œ í•¨ìˆ˜
import { deleteLottieFromBucket, putLottieFromBucket } from "./api/lottie";

const router = Router();

router.put("/api/v1/lottie", putLottieFromBucket);
router.delete("/api/v1/lottie", deleteLottieFromBucket);
```

ìœ„ ì½”ë“œì—ì„œ ë³´ì´ëŠ” ê²ƒì²˜ëŸ¼ `putLottieFromBucket`ê³¼ `deleteLottieFromBucket` í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ
ê°ê°ì˜ Routeì— ëŒ€í•œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

í˜„ì¬ëŠ” lottieì— ëŒ€í•œ ìš”ì²­ë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆì§€ë§Œ, ë‹¤ë¥¸ ì—ì…‹ì— ëŒ€í•œ ìš”ì²­ë„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

CloudflareëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ê° ì„œë¹„ìŠ¤ë¼ë¦¬ ì—°ë™ì„±ì´ ì¢‹ì•„ì„œ R2 ë²„í‚·ì„ ìƒì„±í•˜ê³  Workersì˜ ì„¤ì • íŒŒì¼ì— R2 ë²„í‚·ì„ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```toml showLineNumbers
name = "sanity-proxy"
main = "src/index.js"
compatibility_date = "2022-07-12"

workers_dev = false

{/* Workersì™€ R2 ë²„í‚· ì—°ê²° */}
r2_buckets  = [
  { binding = "ASSET_TOWN_CDN_BUCKET", bucket_name = "asset-town-cdn-prod"},
]
```

ìœ„ì™€ ê°™ì´ ì„¤ì •ì„ í•˜ê³  ë‚˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript showLineNumbers
// ì—ì…‹ì— ëŒ€í•´ì„œ ë“¤ê³ ì˜¤ëŠ” íƒ€ì…
interface SanityAsset {
  url: string;
  originalFilename: string;
  uploadId: string;
  assetId: string;
  extension: string;
  mimeType: string;
  path: string;
  _id: string;
  _type: string;
  _createdAt: string;
  _updatedAt: string;
}

// Projectionì— ëŒ€í•œ íƒ€ì…
interface SanityRequest {
  _id: string;
  _type: string;
  title: string;
  description: string;

  // ì—ì…‹ë“¤ (Filterë¥¼ í†µí•´ì„œ ê°€ì ¸ì˜¨ ì—ì…‹ë“¤ì…ë‹ˆë‹¤.)
  // Filter: *[_type in ["lottie", "svg", "gif"]]
  lottie: SanityAsset;
  svg: SanityAsset;
  gif: SanityAsset;
}

// src/api/lottie.ts

const SANITY_USER_AGENT = "Sanity.io webhook delivery"; // Webhookì„ ì²˜ë¦¬í•  ë•Œ User-Agentë¥¼ ì²´í¬í•˜ê¸° ìœ„í•œ ìƒìˆ˜

/**
 * lottieì— ëŒ€í•œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
 * 
 * requestëŠ” Webhookì„ í†µí•´ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì— ëŒ€í•œ ì •ë³´ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.
 * envëŠ” Cloudflare Workersì˜ ì„¤ì • íŒŒì¼ì— ìˆëŠ” R2 ë²„í‚·ì— ëŒ€í•œ ì •ë³´ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.
 * ìì„¸í•œ ë‚´ìš©ì€ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”: https://developers.cloudflare.com/r2/api/workers/workers-api-usage/
 */
export const putLottieFromBucket = async (request: Request, env: Env): Promise<Response> => {
  // Webhookì„ ì²˜ë¦¬í•  ë•Œ User-Agentë¥¼ ì²´í¬í•©ë‹ˆë‹¤.
  if (request.headers.get("user-agent") !== SANITY_USER_AGENT) {
    return new Response(JSON.stringify({ message: "Unauthorized" }), {
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*",
      },
      status: 401,
    });
  }

  // request ê°ì²´ì— ë“¤ì–´ìˆëŠ” ì •ë³´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
  // ê·¸ëŸ¼ Webhook ì„¤ì •ì—ì„œ ì„¤ì •í•œ Filterì™€ Projectionì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  const asset = await request.json<SanityRequest>();

  // Webhookì„ ì²˜ë¦¬í•  ë•Œ Datasetì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
  // í™˜ê²½ ë¶„ë¦¬ë¥¼ ìœ„í•´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  const dataset = request.headers.get("sanity-dataset");

  if (asset.lottie) {
    const lottie = await fetch(asset.lottie.url, {
      headers: {
        "Content-Type": "application/json",
      },
    }).then((response) => response.json());
    /**
     * R2ëŠ” /ë¡œ í´ë”ë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤.
     * @example development/lottie/1234/5678.json
     * @example production/lottie/abcd/efgh.json
     * ìœ„ì™€ ê°™ì´ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
     * 
     * R2ì— ì €ì¥í•  ë°ì´í„° ìŠ¤í‚¤ë§ˆëŠ” ìì‹ ì´ ì •í•˜ê¸° ë‚˜ë¦„ì…ë‹ˆë‹¤.
     */
    const lottiePath = `${dataset}/${asset._type}/${asset._id}/${asset.lottie.assetId}.${asset.lottie.extension}`;

    try {
      // env.{wrangler.tomlì— ì„¤ì •í•œ R2 ë²„í‚· ì´ë¦„}ìœ¼ë¡œ R2ì— ëŒ€í•œ ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      await env.ASSET_TOWN_CDN_BUCKET.put(lottiePath, JSON.stringify(lottie), {
        httpMetadata: {
          contentType: asset.lottie.mimeType,
        },
        // Custom Metadataì— ëŒ€í•œ ì •ë³´ë¥¼ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        customMetadata: {
          ...asset.lottie,
        },
      });
    } catch {
      return new Response(JSON.stringify({ message: "Lottie Put Failed!!!" }), {
        headers: {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
        status: 500,
      });
    }
  }
}
```

`Delete`ì— ëŒ€í•œ í•¨ìˆ˜ë„ ìœ„ì™€ ê°™ì´ ë¹„ìŠ·í•˜ê²Œ ì‘ì„±ë©ë‹ˆë‹¤.
ê·¸ë¦¬ê³  í˜„ì¬ëŠ” `lottie` ì—ì…‹ì— ëŒ€í•´ì„œë§Œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆì§€ë§Œ, í•¨ìˆ˜ë¥¼ ì¡°ê¸ˆ ë¦¬íŒ©í† ë§í•œë‹¤ë©´ ë‹¤ë¥¸ ì—ì…‹ì— ëŒ€í•´ì„œë„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ„ì™€ ê°™ì´ Cloudflare Workersë¥¼ ì´ìš©í•˜ì—¬ Webhookì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ë ‡ê²Œ í•˜ê³  ì´ì œ Sanityì—ì„œ ì—ì…‹ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•˜ë©´ Webhookì´ ë°œìƒí•˜ê³  Cloudflare Workersì— ì „ë‹¬ë˜ê²Œ ë©ë‹ˆë‹¤.
ê·¸ëŸ¬ë©´ Cloudflare Workersì—ì„œ í•´ë‹¹ ì—ì…‹ì„ ë‹¤ì‹œ R2ì— ì €ì¥í•©ë‹ˆë‹¤.

## R2ë¥¼ ì´ìš©í•œ CDN ìºì‹±

<Callout type="info">
[Cloudflare R2](https://www.cloudflare.com/ko-kr/developer-platform/r2/)ëŠ” Cloudflareì—ì„œ ì œê³µí•˜ëŠ” ë²„í‚· ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì´ ë²„í‚·ì„ ì´ìš©í•˜ì—¬ ì—ì…‹ì„ ìºì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
AWSì˜ S3ì™€ ë¹„ìŠ·í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.
</Callout>

SanityëŠ” CDN ì¡°íšŒì— ëŒ€í•œ ë¹„ìš©ì„ ì²­êµ¬í•˜ì§€ë§Œ, Cloudflare R2ëŠ” CDN ì¡°íšŒì— ëŒ€í•œ ë¹„ìš©ì„ ì²­êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
**ë‹¨, ì¡°ê±´ì€ ìì‹ ì˜ ì»¤ìŠ¤í…€ ë„ë©”ì¸ì„ R2ì— ì—°ê²°í•˜ê³  R2ë¥¼ Publicí•˜ê²Œ ì˜¤í”ˆí•´ì•¼ í•©ë‹ˆë‹¤.**

ê·¸ë¦¬ê³  Cloudflare R2ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ì ì¸ ìºì‹± ì •ì±…ì— ëŒ€í•œ ë¬¸ì„œì— ì í˜€ìˆëŠ”
ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹±ì´ ë˜ëŠ” íŒŒì¼ë“¤ì˜ í™•ì¥ìë“¤ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

{/* ![R2ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹œí•´ì£¼ëŠ” í™•ì¥ìë“¤](./4.png) */}

ì´ë ‡ê²Œ R2ì— ì»¤ìŠ¤í…€ ë„ë©”ì¸ê¹Œì§€ ì—°ê²°í•˜ë©´ CDN ì¡°íšŒì— ëŒ€í•œ ë¹„ìš©ì„ ì²­êµ¬í•˜ì§€ ì•Šê³ 
ìœ ì €ì—ê²Œ ì—ì…‹ì— ëŒ€í•œ Public URLì„ ë¬´ë£Œë¡œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Sanityì—ì„œ ì œê³µí•˜ëŠ” CDN ì¡°íšŒì— ëŒ€í•œ ë¹„ìš©ì„ ì¤„ì´ê¸° ìœ„í•´ ì•½ê°„ì˜ í•´í‚¤í•œ ë°©ë²•ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

Sanityì—ì„œ ë‚ ë¼ì˜¤ëŠ” Webhook ì •ë³´ë¥¼ í†µí•´ì„œ Cloudflare R2ì— ì €ì¥í•  ë•Œ
ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ URL í¬ë§·ì„ ì •ì˜í•˜ê³ , ê·¸ í¬ë§·ì— ë§ê²Œ ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ìœ ì €ì—ê²Œ URLì„ ì œê³µí•  ë•Œë„ R2ì— ì €ì¥ëœ URLì„ ì œê³µí•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—
`Sanity CDN to R2 CDN`ê³¼ ê°™ì€ ìœ í‹¸ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ë§¤í•‘ì„ í•´ì•¼ í•©ë‹ˆë‹¤.

```typescript showLineNumbers
// utils/url.ts

/**
 * Sanity CDN URLì„ R2 CDN URLë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
 * 
 * @param {string} url - Sanity CDN URL
 * @param {string} dataset - Dataset ì´ë¦„
 * @param {string} type - ì—ì…‹ íƒ€ì…
 * @param {string} id - ì—ì…‹ ID
 * @param {string} assetId - ì—ì…‹ Asset ID
 * @param {string} extension - ì—ì…‹ í™•ì¥ì
 * @returns {string} - R2 CDN URL
 */
export const sanityCdnToR2Cdn = (url: string, dataset: string, type: string, id: string, assetId: string, extension: string): string => {
  const r2CdnUrl = new URL(url);
  r2CdnUrl.hostname = `{your-r2-custom-domain}`; // R2 ì»¤ìŠ¤í…€ ë„ë©”ì¸
  r2CdnUrl.pathname = `${dataset}/${type}/${id}/${assetId}.${extension}`;
  return r2CdnUrl.toString();
};
```

## ë§ˆì¹˜ë©°

ì´ë²ˆ ê¸€ì—ì„œëŠ” ì—ì…‹íƒ€ìš´ì—ì„œ Cloudflare Workersì™€ R2ë¥¼ ì´ìš©í•˜ì—¬ ì›¹í›…ì„ ì²˜ë¦¬í•˜ê³  CDN ìºì‹±ì„ ì œê³µí•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.
ë‹¤ìŒ ê¸€ì—ì„œëŠ” Figma Pluginì„ ì´ìš©í•˜ì—¬ ì—ì…‹ì„ ì „ì‹œí•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

## ì°¸ê³ 

- [Sanity Webhook ê³µì‹ ë¬¸ì„œ](https://www.sanity.io/docs/webhooks)
- [Cloudflare Workers ê³µì‹ ë¬¸ì„œ](https://developers.cloudflare.com/workers)
- [Cloudflare R2 ê³µì‹ ë¬¸ì„œ](https://developers.cloudflare.com/r2)
- [itty-router](https://github.com/kwhitley/itty-router)
- [Cloudflare R2 Public Bucket](https://developers.cloudflare.com/r2/buckets/public-buckets/)
- [Cloudflare R2 Default Cache Behavior](https://developers.cloudflare.com/cache/concepts/default-cache-behavior/)


[`rehype-pretty-code`](https://github.com/atomiks/rehype-pretty-code) is a Rehype plugin powered by the
[`shiki`](https://github.com/shikijs/shiki) syntax highlighter that provides beautiful code blocks for Markdown or MDX. It works on both the server at build-time (avoiding runtime syntax highlighting) and on the client for dynamic highlighting.

## Editor-Grade Highlighting

<span className="mix-blend-plus-lighter text-zinc-400/80">
  Enjoy the accuracy and granularity of VS Code's syntax highlighting engine and
  the popularity of its themes ecosystem â€” use any VS Code theme you want!
</span>

## Line Numbers and Line Highlighting

Draw attention to a particular line of code.

```js {4} showLineNumbers
import { useFloating } from "@floating-ui/react";

function MyComponent() {
  const { refs, floatingStyles } = useFloating();

  return (
    <>
      <div ref={refs.setReference} />
      <div ref={refs.setFloating} style={floatingStyles} />
    </>
  );
}
```

## Word Highlighting

Draw attention to a particular word or series of characters.

```js /floatingStyles/
import { useFloating } from "@floating-ui/react";

function MyComponent() {
  const { refs, floatingStyles } = useFloating();

  return (
    <>
      <div ref={refs.setReference} />
      <div ref={refs.setFloating} style={floatingStyles} />
    </>
  );
}
```

## ANSI Highlighting

```ansi
[0;36m  vite v5.0.0[0;32m dev server running at:[0m
  > Local: [0;36mhttp://localhost:[0;36;1m3000[0;36m/[0m
  > Network: [0;2muse `--host` to expose[0m
  [0;36mready in 125ms.[0m
[0;2m8:38:02 PM[0m [0;36;1m[vite][0m [0;32mhmr update [0;2m/src/App.jsx
```

Inline ANSI: `> Local: [0;36mhttp://localhost:[0;36;1m3000[0;36m/[0m{:ansi}`

---

### Kitchen Sink Meta Strings

```js showLineNumbers {2-4} title="isEven.js" /console/ caption="Im a caption"
function isEven(number) {
  if (number === 1) {
    return false;
  } else if (number === 2) {
    return true;
  } else if (number === 3) {
    return false;
  } else if (number === 4) {
    return true;
  } else if (number === 5) {
    return false;
  } else if (number === 6) {
    return true;
  } else if (number === 7) {
    return false;
  } else if (number === 8) {
    return true;
  } else if (number === 9) {
    return false;
  } else if (number === 10) {
    return true;
  } else {
    return "Number is not between 1 and 10.";
  }
}

// Example usage:
console.log(isEven(3)); // Should return false
console.log(isEven(4)); // Should return true
console.log(isEven(11)); // Should return "Number is not between 1 and 10."
```